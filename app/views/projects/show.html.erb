<% @project.mentor_id == current_user.id || @project.mentee_id == current_user.id ? mentor_mentee = true : mentor_mentee = false %>

<section class="project-page">

  <h4>Project information</h4>

  <p><%= @project.name %><p>


</section>

<section class="skills">

    <span class="title">Skills:</span>
    <span class="project_skills">
      <% if mentor_mentee %>
        <%= form_tag('/skills', method: :post, remote: false) do %>
          <input type=hidden name="origin" value="project">
          <input type=hidden name="project_id" value="<%= @project.id %>">
          <input type=hidden name="project_name" value="<%= @project.name %>">
          <%= text_field_tag(:skill_name) %>
          <%= submit_tag("Add skill") %>
        <% end %>
      <% end %>
      <span>
        <ul id="container_project_skills">
          <% if !@project_skills.blank? %>
            <% @project_skills.each do |s| %>
              <li id='<%= s.id %>' ><%= s.skill_name %>
                <% if mentor_mentee %>
                  <%= link_to skill_path(id: s.id, skill_name: s.skill_name, origin: "project", project_id: @project.id, project_name: @project.name), method: :delete do %>
                      <i class="fa fa-times" aria-hidden="true"></i>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          <% else %>
            This project has no skills attached.
          <% end %>
        </ul>
      </span>
    </span>
  </span>


</section>


<section class="goals">

    <span class="title">Goals:</span>
    <span class="project_goals">
      <% if mentor_mentee %>
        <%= form_tag(project_goals_path(@project.id), method: :post, remote: false) do %>
          <input type=hidden name="project_name" value="<%= @project.name %>">
          <%= text_field_tag(:goal_title) %>
          <%= submit_tag("Add goal") %>
        <% end %>
      <% end %>
      <span>
        <ul id="container_project_goals">
          <% if !@project_goals.blank? %>
            <% @project_goals.each do |g| %>
              <li id='<%= g.id %>'><strong>Title:</strong> <%= g.title %>
                <% if mentor_mentee %>
                  <%= link_to project_goal_path(goal_id: g.id, goal_title: g.title, project_id: @project.id, project_name: @project.name), method: :delete do %>
                      <i class="fa fa-times" aria-hidden="true"></i>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          <% else %>
            This project has no goals attached.
          <% end %>
        </ul>

        <% if !flash[:warning].nil? %>
          <% flash.each do |key, value| %>
            <div class="alert_message"><%= value %></div>
          <% end %>
        <% end %>

      </span>
    </span>
  </span>


</section>

<section class="comments">

  <span class="title">Comments:</span><br>
  <span class="add_comments">
    <% if mentor_mentee %>
      <%= form_tag(project_comments_path(@project.id), method: :post, remote: false) do %>
        <%= text_area_tag(:comment, nil, cols: 80, rows: 5) %>
        <%= check_box_tag(:action_required) %> Answer required?

        <% if @project_goals.present? %>
          <br><%= radio_button_tag(:project_or_goal, "project", true) %>About the project in general
          <br><%= radio_button_tag(:project_or_goal, "goal") %>About one especific goal: <%= select_tag(:goal_id, options_from_collection_for_select(@project_goals, :id, :title)) %>
        <% else %>
          <br><%= radio_button_tag(:project_or_goal, "project", true) %>About the project in general
          <br>This project has no goals. The comment will be attached to the project in general.
        <% end %>

        <br><%= submit_tag("Add comment") %>
      <% end %>
    <% end %>
  </span>
  <br>
  <span class="show_comments">

      <strong>Comments attached to project:</strong>
        <div class="container_comments">
          <% if @comments.where(goal_id: nil).present? %>
            <ul>
              <% @comments.where(goal_id: nil).each do |c| %>
                <li id='<%= c.id %>'>
                  <%= c.created_at.to_date %> - <%= c.name %>: <%= c.comment %>.
                  <% if c.action_required %>
                    <span class="alert_message">Answer required.</span>
                  <% end %>
                </li>
              <% end %>
            </ul>
          <% else %>
            No comments attached to this project.
          <% end %>
        </div>

        <% if @project_goals.present? %>
          <% @project_goals.each do |g| %>
            <strong>Comments attached to goal '<%= g.title %>':</strong>
            <div class="container_comments">
              <% if @comments.where(goal_id: g.id).present? %>
                <ul>
                  <% @comments.where(goal_id: g.id).each do |c| %>
                    <li id='<%= c.id %>'>
                      <%= c.created_at.to_date %> - <%= c.name %>: <%= c.comment %>.
                      <% if c.action_required %>
                        <span class="alert_message">Answer required.</span>
                      <% end %>
                    </li>
                  <% end %>
                </ul>
              <% else %>
                No comments attached to this goal.
              <% end %>
            </div>
          <% end %>
        <% end %>
  </span>

</span>


</section>

